<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
</head>
<body>
  <h2>Admin Login</h2>
  <input id="user" placeholder="Username">
  <input id="pass" placeholder="Password" type="password">
  <button onclick="login()">Login</button>
  <p id="status"></p>
  <div id="dashboard"></div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzggyb9cWoZCoJwJo1__xN7GvNZdCCwDDTAPL-rg9JKF_zaGM-Dr70tZ-fqfeHAZ6WYyw/exec";
let token = "";

function login() {
  fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({ action: "login", username: document.getElementById("user").value, password: document.getElementById("pass").value })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      token = data.token;
      document.getElementById("status").innerText = "Login successful!";
      loadRequests();
    } else {
      document.getElementById("status").innerText = "Login failed.";
    }
  });
}

function loadRequests() {
  fetch(scriptURL + "?admin=true&token=" + token)
    .then(res => res.json())
    .then(data => {
      let html = "<h3>Requests</h3>";
      data.requests.forEach(r => {
        html += `<p>${r.requestId} | ${r.customerName} | ${r.service} | Status: ${r.status} | Engineer: ${r.engineerName || "None"}
          <select id="eng-${r.requestId}">${data.engineers.map(e => `<option value="${e.id}">${e.name}</option>`)}</select>
          <button onclick="assign('${r.requestId}')">Assign</button></p>`;
      });
      document.getElementById("dashboard").innerHTML = html;
    });
}

function assign(reqId) {
  let engId = document.getElementById("eng-" + reqId).value;
  let engName = document.getElementById("eng-" + reqId).selectedOptions[0].text;
  fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({ action: "assign", token: token, requestId: reqId, engineerId: engId, engineerName: engName })
  }).then(() => loadRequests());
}
</script>
</body>
</html>

